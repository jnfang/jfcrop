(function(e){e.fn.jfcrop=function(t){function f(e,t){var r=n.cropwidth/(t.width||1);var i=n.cropheight/(t.height||1);s=document.getElementById(n.canvasid);s.width=n.cropwidth;s.height=n.cropheight;o=s.getContext("2d");var u=new Image;u.onload=function(){var e=t.x1;var r=t.y1;var i=t.width||1;var s=t.height||1;var a=n.cropwidth;var f=n.cropheight;var l=0;var c=0;o.drawImage(u,e,r,i,s,l,c,a,f)};u.src=e.src}function l(e){var t=atob(e.split(",")[1]);var r=[];for(var i=0;i<t.length;i++){r.push(t.charCodeAt(i))}return new Blob([new Uint8Array(r)],{type:"image/"+n.cropformat})}function c(t){t.stopPropagation();i=s.toDataURL("image/"+n.cropformat,n.cropquality);u=JSON.stringify(i);var r=l(i);var o=new FormData;o.append("img",r,n.imgName+"."+n.cropformat);if(n.onlyenc_URL){if(n.handler=="post"){e.ajax({url:n.posturl,type:"POST",processData:false,contentType:false,data:o,success:alert("Successful upload!")})}else{n.handler(o)}}else{n.handler(u)}}var n=e.extend({canvasid:"myCanvas",aspectRatio:"1:1",handles:true,cropwidth:100,cropheight:100,onlyenc_URL:true,cropquality:.5,cropformat:"jpeg",buttonid:"submitbtn",posturl:"/",handler:"post",imgName:"imgname"},t);this.imgAreaSelect({aspectRatio:n.aspectRatio,handles:n.handles,onSelectChange:f});var r,i,s,o,u;var a=this;e("#"+n.buttonid).unbind("click").click(c);}})(jQuery)