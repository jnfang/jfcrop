(function($){$.fn.jfcrop=function(options){"""canvasid is the id of the canvas element on page.will be where image preview is shown aspectRatio,handles are a part of imageAreaSelect parameters onlyenc_URL:if set true handler will be executed on a FormData object,if false handler will be executed on the dataURL converted from canvas cropquality:value from 0 to 1 with 1 being best quality and slowest conversion from canvas to dataURL buttonid:id of button that triggers posting of final cropped image handler:function that is executed on cropped file or dataURL imgName:if sending post request,will save file under this name"""var settings=$.extend({canvasid:'myCanvas',aspectRatio:'1:1',handles:true,cropwidth:100,cropheight:100,onlyenc_URL:true,cropquality:0.5,cropformat:'jpeg',buttonid:"submitbtn",posturl:'/',handler:'post',imgName:'imgname',},options);this.imgAreaSelect({aspectRatio:settings.aspectRatio,handles:settings.handles,onSelectChange:preview});var sendURL,dataURL,canvas,context,tosubmit;var origimage=this;$('#'+settings.buttonid).unbind('click').click(submittodo);function preview(img,selection){var scaleX=settings.cropwidth/(selection.width||1);var scaleY=settings.cropheight/(selection.height||1);canvas=document.getElementById(settings.canvasid);canvas.width=settings.cropwidth;canvas.height=settings.cropheight;context=canvas.getContext('2d');var imageObj=new Image();imageObj.onload=function(){var sourceX=selection.x1;var sourceY=selection.y1;var sourceWidth=selection.width||1;var sourceHeight=selection.height||1;var destWidth=settings.cropwidth;var destHeight=settings.cropheight;var destX=0;var destY=0;context.drawImage(imageObj,sourceX,sourceY,sourceWidth,sourceHeight,destX,destY,destWidth,destHeight)};imageObj.src=img.src};function dataURLtoBlob(dataURL){var binary=atob(dataURL.split(',')[1]);var array=[];for(var i=0;i<binary.length;i++){array.push(binary.charCodeAt(i))}return new Blob([new Uint8Array(array)],{type:'image/'+settings.cropformat})};function submittodo(e){e.stopPropagation();dataURL=canvas.toDataURL('image/'+settings.cropformat,settings.cropquality);tosubmit=JSON.stringify(dataURL);var fl=dataURLtoBlob(dataURL);var fd=new FormData();fd.append('img',fl,settings.imgName+"."+settings.cropformat);if(settings.onlyenc_URL){if(settings.handler=='post'){$.ajax({url:settings.posturl,type:'POST',processData:false,contentType:false,data:fd,success:alert("Successful upload!"),})}else{settings.handler(fd)}}else{settings.handler(tosubmit)}}}}(jQuery));